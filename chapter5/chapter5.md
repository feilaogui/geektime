# 微服务可用性设计

## 限流

单机限流：令牌桶、漏桶。实现：golang/x/time/ratelimit

自适应限流：bbr限流。

全局限流

## 熔断

发起服务调用的时候，如果被调用方返回的错误率超过一定的阈值，那么后续的请求将不会真正发起请求，而是在调用方直接返回错误。

熔断常见的有开启，关闭，半开启的状态， Google SRE。

## 降级

通过降级回复来减少工作量，或者丢弃不重要的请求。而且需要了解哪些流量可以降级，并且有能力区分不同的请求。我们通常提供降低回复的质量来答复减少所需的计算量或者时间

## 重试的注意事项

重试一定要注意避免雪崩，重试只能在错误发生的地方进行重试，不能级联重试，级联重试很容易造成雪崩，一般的做法就是全局约定 错误码 只要出现这个 错误码 我们就知道下游已经尝试过重试了，我们就不要再重试了。

## 负载均衡的常用方式

随机法：随机从可用服务列表中选取一个服务来分发请求。

轮训或加权轮训：JSQ(最闲轮训)

p2c算法：随机选取两个节点进行打分。